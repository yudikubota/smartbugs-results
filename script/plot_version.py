import matplotlib.pyplot as plt
import numpy as np
from collections import OrderedDict
import semver
from functools import cmp_to_key

dist = {'0.4.13': 148, '0.4.4': 86, '0.6.12': 1056, '0.8.4': 4093, '0.4.25': 724, '0.8.9': 2216, '0.7.5': 566, '0.8.12': 470, '0.8.11': 384, '0.8.0': 6763, '0.8.6': 297, '0.4.19': 319, '0.7.6': 247, '0.4.20': 445, '0.4.23': 279, '0.7.0': 2195, '0.4.24': 1320, '0.8.17': 478, '0.8.13': 538, '0.5.0': 511, '0.5.4': 46, '0.6.11': 67, '0.6.2': 98, '0.8.5': 176, '0.4.21': 262, '0.8.10': 728, '0.8.3': 294, '0.6.0': 629, '0.8.15': 332, '0.4.22': 137, '0.4.16': 159, '0.4.18': 806, '0.8.16': 228, '0.5.8': 71, '0.8.2': 172, '0.8.7': 1088, '0.4.26': 89, '0.4.11': 225, '0.5.16': 126, '0.5.11': 95, '0.5.17': 148, '0.8.14': 132, '0.5.3': 176, '0.4.15': 136, '0.7.3': 28, '0.4.2': 59, '0.5.2': 55, '0.5.10': 95, '0.6.6': 96, '0.5.0': 8, '0.8.8': 70, '0.4.7': 20, '0.7.4': 90, '0.8.1': 366, '0.4.8': 67, '0.4.10': 183, '0.6.3': 12, '0.6.9': 14, '0.6.8': 46, '0.4.17': 63, '0.5.14': 25, '0.5.7': 57, '0.5.12': 41, '0.7.1': 24, '0.5.1': 50, '0.4.0': 99, '0.6.4': 17, '0.6.1': 10, '0.5.6': 25, '0.8.0': 17, '0.5.9': 29, '0.4.0': 13, '0.4.9': 44, '0.5.15': 26, '0.6.7': 9, '0.4.3': 3, '0.4.99': 5, '0.6.10': 24, '0.4.6': 25, '0.5.13': 19, '0.4.1': 8, '0.8.11': 2, '0.4.12': 21, '0.6.0': 8, '0.5.5': 20, '0.7.2': 6, '0.6.5': 2, '0.4.14': 12, '0.1.1': 3}
# dist = {'0.4.13': 148, '0.4.4': 86, '0.6.12': 1056, '0.8.4': 4093, '0.4.25': 724, '0.8.9': 2216, '0.7.5': 566, '0.8.12': 470, '0.8.11': 384, '0.8.0': 6763, '0.8.6': 297, '0.4.19': 319, '0.7.6': 247, '0.4.20': 445, '0.4.23': 279, '0.7.0': 2195, '0.4.24': 1320, '0.8.17': 478, '0.8.13': 538, '0.5.0': 511, '0.5.4': 46, '0.6.11': 67, '0.6.2': 98, '0.8.5': 176, '0.4.21': 262, '0.8.10': 728, '0.8.3': 294, '0.6.0': 629, '0.8.15': 332, '0.4.22': 137, '0.4.16': 159, '0.4.18': 806, '0.8.16': 228, '0.5.8': 71, '0.8.2': 172, '0.8.7': 1088, '0.4.26': 89, '0.4.11': 225, '0.5.16': 126, '0.5.11': 95, '0.5.17': 148, '0.8.14': 132, '0.5.3': 176, '0.4.15': 136, '0.7.3': 28, '0.4.2': 59, '0.5.2': 55, '0.5.10': 95, '0.6.6': 96, '0.5': 8, '0.8.8': 70, '0.4.7': 20, '0.7.4': 90, '0.8.1': 366, '0.4.8': 67, '0.4.10': 183, '0.6.3': 12, '0.6.9': 14, '0.6.8': 46, '0.4.17': 63, '0.5.14': 25, '0.5.7': 57, '0.5.12': 41, '0.7.1': 24, '0.5.1': 50, '0.4.0': 99, '0.6.4': 17, '0.6.1': 10, '0.5.6': 25, '0.8': 17, '0.5.9': 29, '0.4': 13, '0.4.9': 44, '0.5.15': 26, '0.6.7': 9, '0.4.3': 3, '0.4.99': 5, '0.6.10': 24, '0.4.6': 25, '0.5.13': 19, '0.4.1': 8, '0.8.11.0': 2, '0.4.12': 21, '0.6': 8, '0.5.5': 20, '0.7.2': 6, '0.6.5': 2, '0.4.14': 12, '0.1.1': 3}
# dist = {'0.4.13': 148, '0.4.4': 86, '0.6.12': 1056, '0.8.4': 4078, '0.4.25': 714, '0.8.9': 1544, '0.7.5': 566, '0.8.12': 467, '0.8.11': 381, '0.8.0': 6660, '0.8.6': 296, '0.4.19': 318, '0.7.6': 247, '0.4.20': 445, '0.4.23': 271, '0.4.24': 1299, '0.8.17': 466, '0.8.13': 526, '0.5.0': 487, '0.5.4': 45, '0.6.11': 67, '0.6.2': 91, '0.8.5': 176, '0.4.21': 246, '0.8.10': 645, '0.8.3': 294, '0.6.0': 325, '0.8.15': 329, '0.4.16': 158, '0.7.0': 456, '0.4.18': 805, '0.8.16': 228, '0.5.8': 71, '0.8.2': 171, '0.8.7': 1084, '0.4.26': 88, '0.4.11': 225, '0.5.16': 121, '0.5.11': 93, '0.5.17': 145, '0.8.14': 132, '0.5.3': 176, '0.4.15': 136, '0.7.3': 28, '0.4.2': 59, '0.5.2': 55, '0.5.10': 95, '0.6.6': 95, '0.5': 8, '0.8.8': 69, '0.4.7': 20, '0.7.4': 90, '0.8.1': 366, '0.4.8': 67, '0.4.10': 183, '0.6.3': 12, '0.6.9': 14, '0.6.8': 46, '0.4.17': 63, '0.5.14': 25, '0.5.7': 57, '0.5.12': 39, '0.7.1': 24, '0.5.1': 50, '0.4.0': 97, '0.6.4': 17, '0.5.6': 24, '0.8': 16, '0.5.9': 29, '0.4.9': 44, '0.4.22': 55, '0.5.15': 26, '0.6.7': 9, '0.6.1': 8, '0.4.3': 3, '0.4.6': 25, '0.5.13': 19, '0.6.10': 19, '0.4.1': 5, '0.8.11.0': 2, '0.4.12': 21, '0.5.5': 20, '0.7.2': 6, '0.6.5': 2, '0.4.14': 12, '0.4': 1}
# dist = {"0.8.17": 5811, "0.6.8": 3, "0.7.4": 5, "0.8.6": 59, "0.8.16": 31, "0.8.10": 51, "0.8.12": 35, "0.8.0": 24, "0.7.6": 257, "0.8.13": 69, "0.8.4": 71, "0.8.2": 19, "0.8.15": 42, "0.8.11": 61, "0.6.12": 62, "0.7.3": 6, "0.8.9": 105, "0.8.14": 29, "0.8.5": 13, "0.4.24": 2, "0.7.5": 4, "0.8.7": 99, "0.5.17": 17, "0.7.1": 3, "0.8.3": 7, "0.6.6": 5, "0.8.8": 6, "0.6.10": 3, "0.5.16": 3, "0.5.9": 3, "0.6.4": 4, "0.6.11": 9, "0.8.1": 3, "0.6.1": 1, "0.7.0": 3, "0.6.2": 1, "0.5.14": 1, "0.5.11": 2, "0.7.2": 1}

# order by version according to semver
dist = OrderedDict(sorted(dist.items(), key=lambda t: semver.VersionInfo.parse(t[0])))

# dist = sorted(dist.items(), key=cmp_to_key(lambda a, b: semver.compare(a, b) ))
# dist = OrderedDict(sorted(dist.items(), key=cmp_to_key(lambda a, b: semver.compare(a, b) )))
# dist = OrderedDict(sorted(dist.items(), key=lambda t: t[0]))

# sum of all versions
total = sum(dist.values())

print(dist)
print(total)

# plot version distribution
plt.bar(range(len(dist)), dist.values(), align='center')
plt.xticks(range(len(dist)), dist.keys(), rotation=90)
plt.savefig('plot_version.png')
